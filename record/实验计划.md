### 实验计划：模型与噪声增广对SER性能影响

本计划覆盖 RAVDESS 与 IEMOCAP 两数据集，比较不同模型与噪声方案（白噪声、ESC-50 环境噪声）对鲁棒性与准确率的影响。每组实验均自动归档到 `experiments/<YYYYMMDD_HHMMSS>_<dataset>_<model>/`，包含日志、曲线、混淆矩阵、最佳指标与 checkpoints。

## 公共设置
- 数据集
  - RAVDESS：`config/config.yaml`
  - IEMOCAP：`config/iemocap.yaml`（按会话划分，默认 4 类）
- 模型
  - ResNet18（mel 谱）、AST Base（fbank）
- 训练参数（建议）
  - RAVDESS：batch 128, epochs 50, lr 1e-3（ResNet18）/ 1e-4（AST）
  - IEMOCAP：batch 128（已在配置中），epochs 50, lr 1e-4
  - 随机种子：42（如需重复性更强，建议再跑 2 次种子：0,1,2）
- 评估指标：Accuracy、Precision、Recall、Macro-F1（验证集）；并输出混淆矩阵
- 日志产物（每次实验自动生成）
  - main.log, training_history.png, confusion_matrix.png
  - epoch_metrics.csv, best_metrics.json
  - checkpoints/*_best.pth, *_epoch_*.pth

提示
- 噪声增强通过 `config/noise.yaml` 启用；训练命令不变，配置会自动合并。
- 验证集永远保持“干净”，衡量泛化与鲁棒性。

## 实验A：无增广基线（Clean→Clean/Noisy Test）
- 实验名称：A-Clean-Baseline
- 实验说明：不启用任何噪声增广，作为全局对照。
- 噪声参数：`config/noise.yaml` 中 `enabled: false`
- 推荐模型×数据集
  - RAVDESS：mlp, shallow CNN, ResNet18、AST Base
  - IEMOCAP：mlp, shallow CNN, ResNet18、AST Base
- 命令
```bash
# RAVDESS
python main.py --config config/config.yaml --model mlp --batch-size 128
python main.py --config config/config.yaml --model shallow_cnn --batch-size 128
python main.py --config config/config.yaml --model resnet18 --batch-size 128
python main.py --config config/config.yaml --model ast_base --batch-size 64

# IEMOCAP
python main.py --config config/iemocap.yaml --model mlp --batch-size 128
python main.py --config config/iemocap.yaml --model shallow_cnn --batch-size 128
python main.py --config config/iemocap.yaml --model resnet18 --batch-size 128
python main.py --config config/iemocap.yaml --model ast_base --batch-size 128
```
- 预期图表
  - 训练/验证曲线：训练是否过拟合；验证为干净集的性能天花板
  - 混淆矩阵：类别可分性

## 实验B：白噪声（固定 20 dB）
- 实验名称：B-White-20dB
- 实验说明：训练时以概率 p 将白噪声（SNR=20 dB）混入语音，验证集保持干净。
- 噪声参数（编辑 `config/noise.yaml`）
```yaml
noise_augmentation:
  enabled: true
  type: white
  p_apply: 0.7
  snr_db_choices: [20.0]
  target_peak_dbfs: -1.0
```
- 命令
```bash
# RAVDESS
python main.py --config config/config.yaml --model resnet18
python main.py --config config/config.yaml --model ast_base

# IEMOCAP
python main.py --config config/iemocap.yaml --model resnet18
python main.py --config config/iemocap.yaml --model ast_base
```
- 预期图表
  - 对比 A vs B 的验证指标条形图：观察白噪声训练是否提升鲁棒性
  - 训练曲线与混淆矩阵变化

## 实验C：ESC-50 多类多 SNR（自然声景/人类非语音）
- 实验名称：C-ESC50-MultiCat-MultiSNR
- 实验说明：训练期随机从两类 ESC-50（自然声景、人类非语音）采样噪声，并随机 SNR∈{0,5,10,20} 混入。
- 噪声参数（编辑 `config/noise.yaml`，二选一）
  - 方案 1：meta 模式（推荐）
```yaml
noise_augmentation:
  enabled: true
  type: esc50
  p_apply: 0.7
  snr_db_choices: [0.0, 5.0, 10.0, 20.0]
  target_peak_dbfs: -1.0
  esc50:
    resample_sr: 16000
    audio_root: d:/PTProjects/EmotionRecognition/data/ESC-50/audio
    meta_csv:   d:/PTProjects/EmotionRecognition/data/ESC-50/meta/esc50.csv
    groups:
      - name: natural_soundscapes
        categories: [rain, sea_waves, crickets, chirping_birds, wind, frog, thunderstorm, water_drops, crackling_fire, insects]
      - name: human_non_speech
        categories: [coughing, sneezing, breathing, laughing, footsteps, clapping]
```
  - 方案 2：目录模式（若你已手动整理目录）
```yaml
noise_augmentation:
  enabled: true
  type: esc50
  p_apply: 0.7
  snr_db_choices: [0.0, 5.0, 10.0, 20.0]
  target_peak_dbfs: -1.0
  esc50:
    resample_sr: 16000
    categories:
      - name: natural_soundscapes
        path: d:/PTProjects/EmotionRecognition/data/ESC-50/audio/1-100/
      - name: human_non_speech
        path: d:/PTProjects/EmotionRecognition/data/ESC-50/audio/101-200/
```
- 命令
```bash
# RAVDESS
python main.py --config config/config.yaml --model resnet18
python main.py --config config/config.yaml --model ast_base

# IEMOCAP
python main.py --config config/iemocap.yaml --model resnet18
python main.py --config config/iemocap.yaml --model ast_base
```
- 预期图表
  - 模型×噪声类型×SNR 表格/热力图（性能对比）
  - 训练曲线、混淆矩阵

## 实验D：SNR 消融（单类别自然声景，SNR=0/5/10/20）
- 实验名称：D-SNR-Ablation-Nature
- 实验说明：固定 ESC-50 自然声景类别，分别训练四个 SNR 单点模型，绘制性能—SNR 曲线。
- 噪声参数（每个 SNR 单独跑一次，示例 SNR=0）
```yaml
noise_augmentation:
  enabled: true
  type: esc50
  p_apply: 0.7
  snr_db_choices: [0.0]   # 分别改为 [5.0], [10.0], [20.0]
  target_peak_dbfs: -1.0
  esc50:
    resample_sr: 16000
    groups:
      - name: natural_soundscapes
        categories: [rain, sea_waves, crickets, chirping_birds, wind, frog, thunderstorm, water_drops, crackling_fire, insects]
```
- 命令（以 IEMOCAP+ResNet18 为例，四次分别改 snr_db_choices）
```bash
python main.py --config config/iemocap.yaml --model resnet18
# 修改 snr_db_choices 后再跑：
python main.py --config config/iemocap.yaml --model resnet18
python main.py --config config/iemocap.yaml --model resnet18
python main.py --config config/iemocap.yaml --model resnet18
```
- 预期图表
  - 性能—SNR 曲线（Accuracy/Macro-F1 随 SNR 变化）

## 实验E：模型鲁棒性对比（ResNet18 vs AST）
- 实验名称：E-Model-Robustness-Compare
- 实验说明：在同等噪声增广设置下，对比 ResNet18 与 AST Base 在验证集（干净）与噪声测试集（离线混合生成）的差异（可在后续加离线噪声测试）。
- 噪声参数：沿用实验 C 配置（multi-cat, multi-SNR）
- 命令（IEMOCAP 为例）
```bash
python main.py --config config/iemocap.yaml --model resnet18
python main.py --config config/iemocap.yaml --model ast_base
```
- 预期图表
  - 模型×指标条形图（干净 vs 含噪测试）
  - 混淆矩阵差异图（观察易混类别）

## 实验F：增广强度消融（p_apply）
- 实验名称：F-Aug-Intensity-Ablation
- 实验说明：固定 ESC-50 multi-SNR，修改 `p_apply∈{0.3, 0.5, 0.7, 0.9}`，寻找最佳增广强度。
- 噪声参数（示例 p_apply=0.5）
```yaml
noise_augmentation:
  enabled: true
  type: esc50
  p_apply: 0.5    # 分别改为 0.3, 0.7, 0.9 再跑
  snr_db_choices: [0.0, 5.0, 10.0, 20.0]
  target_peak_dbfs: -1.0
  esc50:
    resample_sr: 16000
    audio_root: d:/PTProjects/EmotionRecognition/data/ESC-50/audio
    meta_csv:   d:/PTProjects/EmotionRecognition/data/ESC-50/meta/esc50.csv
    groups:
      - name: natural_soundscapes
        categories: [rain, sea_waves, crickets, chirping_birds, wind, frog, thunderstorm, water_drops, crackling_fire, insects]
      - name: human_non_speech
        categories: [coughing, sneezing, breathing, laughing, footsteps, clapping]
```
- 命令（IEMOCAP+AST 为例，四次分别改 p_apply）
```bash
python main.py --config config/iemocap.yaml --model ast_base
# 修改 p_apply 后重复
python main.py --config config/iemocap.yaml --model ast_base
python main.py --config config/iemocap.yaml --model ast_base
python main.py --config config/iemocap.yaml --model ast_base
```
- 预期图表
  - p_apply—性能曲线（观察过强/过弱增广的拐点）

## 结果汇总与可视化（建议）
- 汇总维度
  - 模型 × 噪声类型（无/白噪/ESC-50） × SNR（单点或集合） × 数据集
- 图表
  - 性能—SNR 曲线（每模型一条）
  - 条形图：不同噪声方案的 Macro-F1 对比
  - 混淆矩阵（关键实验）
- 产物位置
  - 每次运行的 `experiments/<时间>_<dataset>_<model>/` 内已有：training_history.png、confusion_matrix.png、best_metrics.json、epoch_metrics.csv、*_best.pth

## 运行小贴士
- Windows 路径大小写与盘符需与 `config/noise.yaml` 一致（示例使用 `d:/...`）。
- IEMOCAP 默认 4 类（excited→happy），若扩展类别请同步调整 `config/iemocap.yaml` 中 `emotions` 与 `emotion_mapping`，并确保 `models.*.num_classes` 一致。
- 若显存紧张：降低 batch size；AST 可优先跑 small 或 tiny 验证流程。
- 如需严格可复现：每组实验至少固定一个种子（42），关键结论建议 3 个种子取均值 ± 方差。


